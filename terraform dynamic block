provider "aws" {
   region     = "ap-south-1"
   access_key = "A"
   secret_key = "vW"
   
}
locals {
   ingress_rules = [{
      port        = 443
      description = "Ingress rules for port 443"
   },
   {
      port        = 80
      description = "Ingree rules for port 80"
   }]
}

resource "aws_instance" "ec2_example" {
   
   ami           = "ami-0f5ee92e2d63afc18" 
   instance_type = "t2.micro"
   key_name      = "aws_key"
   vpc_security_group_ids = [aws_security_group.main.id]
}

resource "aws_security_group" "main" {
  egress = [
    {
      cidr_blocks       = ["0.0.0.0/0"]
      description       = ""
      from_port         = 0
      ipv6_cidr_blocks  = []
      prefix_list_ids   = []
      protocol          = "-1"
      security_groups   = []
      self              = false
      to_port           = 0
    }
  ]

dynamic "ingress" {
    for_each = local.ingress_rules

    content {
      description = ingress.value.description
      from_port   = ingress.value.port
      to_port     = ingress.value.port
      protocol    = "tcp"
      cidr_blocks = ["0.0.0.0/0"]   
    }
  }
}


resource "aws_key_pair" "deployer" {
  key_name   = "aws_key"
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDlJZE8feDp5X563Z/MXKPz9HKkTlH/7BZyH4Sm59q27S9emCSrTtn3rqTwhcLqvQ8vt88CYhLeGbttIeEr1GdondniFfwe+xYCSwYQzUGdCBwaV23O0mHb1Ust/K+/5BqLIKoQrLOer0AK+ta5GfrErJbjI9Ao3VEye98NJpl5YivGLvEf1MRDUk21 devendra-wamane@devendra-wamane-LOQ-15IAX9"
}
